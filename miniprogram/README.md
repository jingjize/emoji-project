# 微信小程序版本 - AI 情绪表情生成器

## 项目简介

这是 AI 情绪表情生成器的微信小程序版本，用户可以通过小程序上传图片，选择情绪类型，AI 自动生成对应的情绪表情图片。

## 功能特性

- 📸 图片上传（支持相册和拍照）
- 🎭 8 种情绪选择（高兴、伤心、生气、惊讶、困惑、兴奋、平静、害羞）
- 🤖 AI 自动生成情绪表情图片
- 💾 保存图片到相册
- 🔍 图片预览功能

## 项目结构

```
miniprogram/
├── app.js              # 小程序入口文件
├── app.json            # 小程序配置文件
├── app.wxss            # 全局样式
├── pages/
│   └── index/
│       ├── index.js    # 页面逻辑
│       ├── index.wxml  # 页面结构
│       └── index.wxss  # 页面样式
├── sitemap.json        # 站点地图配置
├── project.config.json # 项目配置
└── README.md           # 说明文档
```

## 配置说明

### 1. 修改 AppID

编辑 `project.config.json`，将 `appid` 替换为你的小程序 AppID：

```json
{
  "appid": "your-appid"
}
```

### 2. 配置后端 API 地址

编辑 `app.js`，修改 `apiBaseUrl`：

```javascript
globalData: {
  // 本地开发
  apiBaseUrl: 'http://localhost:8080/api/meme',
  
  // 或者部署到服务器后
  // apiBaseUrl: 'https://your-domain.com/api/meme',
}
```

**注意**：
- 小程序要求使用 HTTPS（生产环境）
- 需要在微信公众平台配置服务器域名
- 本地开发可以使用开发者工具的不校验合法域名选项

### 3. 配置服务器域名

在微信公众平台（https://mp.weixin.qq.com）配置：

1. 登录小程序后台
2. 进入「开发」→「开发管理」→「开发设置」
3. 在「服务器域名」中添加：
   - request 合法域名：`https://your-domain.com`
   - uploadFile 合法域名：`https://your-domain.com`
   - downloadFile 合法域名：`https://your-domain.com`（如果使用 OSS URL）

## 使用步骤

### 1. 导入项目

1. 打开微信开发者工具
2. 选择「导入项目」
3. 选择 `miniprogram` 目录
4. 输入 AppID（或使用测试号）

### 2. 配置后端地址

确保后端服务已启动，并修改 `app.js` 中的 API 地址。

### 3. 运行项目

1. 在微信开发者工具中点击「编译」
2. 在模拟器或真机上测试

## 功能说明

### 图片上传
- 支持从相册选择或拍照
- 自动验证文件大小（最大 10MB）
- 支持 JPG、PNG 格式

### 情绪选择
- 8 种情绪类型可选
- 点击情绪按钮切换选择
- 默认选择「高兴」

### 生成表情
- 点击「生成情绪表情」按钮
- 显示加载动画
- 生成完成后显示结果图片

### 图片操作
- **预览**：点击生成的图片可全屏预览
- **保存**：点击「保存到相册」保存图片
- **重新生成**：点击「重新生成」重置并重新开始

## API 接口

小程序调用以下后端接口：

1. **生成表情包**
   - 方法：POST
   - 路径：`/api/meme/generate`
   - 参数：
     - `image`: 图片文件
     - `emotion`: 情绪类型（happy, sad, angry 等）

2. **获取情绪列表**
   - 方法：GET
   - 路径：`/api/meme/emotions`

## 注意事项

1. **域名配置**：生产环境必须配置合法域名
2. **HTTPS**：小程序要求使用 HTTPS 协议
3. **文件大小**：图片大小限制为 10MB
4. **权限**：保存图片需要用户授权
5. **OSS URL**：如果返回 OSS URL，小程序会自动下载后保存

## 开发调试

### 本地开发

1. 启动后端服务：`mvn spring-boot:run`
2. 在微信开发者工具中：
   - 设置 → 项目设置 → 本地设置
   - 勾选「不校验合法域名、web-view、TLS 版本以及 HTTPS 证书」

### 真机调试

1. 确保手机和电脑在同一网络
2. 修改 `app.js` 中的 API 地址为电脑 IP：
   ```javascript
   apiBaseUrl: 'http://192.168.x.x:8080/api/meme'
   ```
3. 在开发者工具中点击「预览」，用微信扫码

## 常见问题

### 1. 网络请求失败
- 检查后端服务是否启动
- 检查 API 地址是否正确
- 检查是否配置了合法域名

### 2. 图片上传失败
- 检查图片大小是否超过 10MB
- 检查图片格式是否支持

### 3. 保存图片失败
- 检查是否授权了相册权限
- 如果是 OSS URL，检查网络连接

## 后续优化

- [ ] 添加图片压缩功能
- [ ] 支持批量生成
- [ ] 添加历史记录
- [ ] 优化加载体验
- [ ] 添加分享功能

